<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>News Watch — prova</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background: #0f172a;
      color: #f1f5f9;
    }
    header {
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #111827;
      border-bottom: 1px solid #1f2937;
    }
    h1 { margin: 0; font-size: 20px; }
    button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      font-weight: 600;
      background: #2563eb;
      color: white;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 20px;
    }
    .card {
      background: #1e293b;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 20px;
      border: 1px solid #334155;
    }
    .card h2 {
      margin: 0 0 10px 0;
      font-size: 16px;
    }
    .item {
      padding: 10px 0;
      border-top: 1px solid #334155;
    }
    .item:first-child { border-top: none; }
    .item a {
      color: #60a5fa;
      text-decoration: none;
      font-weight: 600;
    }
    .item small {
      display: block;
      color: #94a3b8;
      margin-top: 4px;
    }
    .status {
      margin-top: 6px;
      font-size: 13px;
      color: #fbbf24;
    }
  </style>
</head>
<body>

<header>
  <h1>News Watch (prova)</h1>
  <button onclick="refresh()">Aggiorna</button>
</header>

<div class="container" id="content"></div>

<script>
const sources = [
  {
    name: "Sea-Watch — News",
    url: "https://sea-watch.org/en/news/"
  },
  {
    name: "SOS Humanity — Press",
    url: "https://sos-humanity.org/en/press/"
  }
];

async function refresh() {
  const container = document.getElementById("content");
  container.innerHTML = "";

  for (const source of sources) {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `<h2>${source.name}</h2><div class="status">Caricamento...</div>`;
    container.appendChild(card);

    try {
      const response = await fetch(source.url);
      const text = await response.text();
      const parser = new DOMParser();
      const doc = parser.parseFromString(text, "text/html");

      const links = Array.from(doc.querySelectorAll("a"))
        .map(a => ({
          title: a.textContent.trim(),
          href: a.href
        }))
        .filter(a => a.title.length > 20 && a.href.includes(source.url));

      card.innerHTML = `<h2>${source.name}</h2>`;

      if (links.length === 0) {
        card.innerHTML += `<div class="status">Nessuna news rilevata.</div>`;
      } else {
        links.slice(0,5).forEach(link => {
          card.innerHTML += `
            <div class="item">
              <a href="${link.href}" target="_blank">${link.title}</a>
            </div>
          `;
        });
      }

    } catch (err) {
      card.innerHTML = `<h2>${source.name}</h2><div class="status">Errore di caricamento (probabile blocco CORS)</div>`;
    }
  }
}
</script>

</body>
</html>
